<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soccer Predictions (API Proxy)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { font-size: 1.4rem; }
    input, button { padding: 8px; margin: 5px; }
    table { border-collapse: collapse; margin-top: 15px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  </style>
</head>
<body>
  <h1>Soccer Predictions (API ผ่าน Proxy)</h1>
  
  <label>Home: <input id="home" placeholder="เช่น Manchester City"></label>
  <label>Away: <input id="away" placeholder="เช่น Arsenal"></label>
  <button onclick="lookup()">Lookup</button>
  <button onclick="loadToday()">วันนี้ทั้งหมด</button>

  <div id="result"></div>

<script>
const API_KEY = "568528145148427fb89dc5484884d1ea"; // << ใส่ token ของคุณไว้ตรงนี้
// URL API ของคุณ (เปลี่ยนให้ตรงกับ provider ที่ให้มา)
const BASE_URL = "https://api.football-data.org/v4/matches";

// Proxy wrapper
function proxyUrl(url) {
  return "https://api.allorigins.win/get?url=" + encodeURIComponent(url);
}

// โหลดแมทช์วันนี้ทั้งหมด
async function loadToday() {
  document.getElementById("result").innerHTML = "กำลังโหลดข้อมูลวันนี้...";
  try {
    const resp = await fetch(proxyUrl(BASE_URL), {
      headers: { "X-Auth-Token": API_KEY }
    });
    const data = await resp.json();
    const contents = JSON.parse(data.contents); // allorigins คืนเป็น string → ต้อง parse อีกที
    
    showMatches(contents.matches);
  } catch (e) {
    document.getElementById("result").innerHTML = "โหลดข้อมูลไม่สำเร็จ: " + e;
  }
}

// ค้นหาคู่แมทช์
async function lookup() {
  const home = document.getElementById("home").value.trim().toLowerCase();
  const away = document.getElementById("away").value.trim().toLowerCase();

  document.getElementById("result").innerHTML = "กำลังค้นหา...";

  try {
    const resp = await fetch(proxyUrl(BASE_URL), {
      headers: { "X-Auth-Token": API_KEY }
    });
    const data = await resp.json();
    const contents = JSON.parse(data.contents);

    const match = contents.matches.find(m =>
      m.homeTeam.name.toLowerCase().includes(home) &&
      m.awayTeam.name.toLowerCase().includes(away)
    );

    if (match) {
      document.getElementById("result").innerHTML = `
        <h3>${match.competition.name}</h3>
        <p>${match.homeTeam.name} vs ${match.awayTeam.name}</p>
        <p>วันที่: ${match.utcDate}</p>
        <p>สถานะ: ${match.status}</p>
      `;
    } else {
      document.getElementById("result").innerHTML = "ไม่พบแมทช์ที่ค้นหา";
    }
  } catch (e) {
    document.getElementById("result").innerHTML = "โหลดข้อมูลไม่สำเร็จ: " + e;
  }
}

// แสดงผลแมทช์ในตาราง
function showMatches(matches) {
  if (!matches || matches.length === 0) {
    document.getElementById("result").innerHTML = "ไม่มีแมทช์วันนี้";
    return;
  }

  let html = "<table><tr><th>Date</th><th>League</th><th>Home</th><th>Away</th><th>Status</th></tr>";
  matches.forEach(m => {
    html += `<tr>
      <td>${m.utcDate}</td>
      <td>${m.competition.name}</td>
      <td>${m.homeTeam.name}</td>
      <td>${m.awayTeam.name}</td>
      <td>${m.status}</td>
    </tr>`;
  });
  html += "</table>";
  document.getElementById("result").innerHTML = html;
}
</script>
</body>
</html>
